Let's generate a new component for our map.

```
ember generate component --with-component-class map
```

Since not every component will necessarily have some defined behavior associated with it, the component generator does not generate a JavaScript file for us by default. As we saw earlier, we can always use the `component-class` generator to add a JavaScript file for a component later on.

However, in the case of our map component, we are pretty sure that we are going to need a JavaScript file for some behavior that we have yet to define! In this case, we can pass the `--with-component-class` flag to the component generator so that we have everything we need from the get-go.

<div class="cta">
  <div class="cta-note">
    <div class="cta-note-body">
      <div class="cta-note-heading">Zoey says...</div>
      <div class="cta-note-message">
        Too much typing? Use `ember g component -gc map` instead. That's a saving of 26 characters, or exactly one alphabet song's worth of characters! The `-gc` flag stands for <strong>G</strong>limmer <strong>c/strong>omponent, but you may also remember it as <strong>g/strong>enerate <strong>c/strong>lass.
      </div>
    </div>
    <img src="/images/mascots/zoey.png" role="presentation" alt="Ember Mascot">
  </div>
</div>

Let's start with our JavaScript file:

```js {data-filename="app/components/map.js" data-diff="+2,+5,+6,+7"}
import Component from '@glimmer/component';
import ENV from 'super-rentals/config/environment';

export default class MapComponent extends Component {
  get token() {
    return encodeURIComponent(ENV.MAPBOX_ACCESS_TOKEN);
  }
}
```

Here, we are importing the access token from the config file and returning it from a `token` *[getter](TODO: link to getter)*. This allows us to access our token as `this.token` on the instance of our component, including on the component's template. It is also important to [URL-encode](TODO: link to URL-encode) the token, just in case it contains any special characters that are not URL-safe.

Now, let's move from the JavaScript file to the template:

```handlebars {data-filename="app/components/map.hbs}
<div class="map">
  <img
    alt="Map image at coordinates {{@lat}},{{@lng}}"
    ...attributes
    src="https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/{{@lng}},{{@lat}},{{@zoom}}/{{@width}}x{{@height}}@2x?access_token={{this.token}}"
    width={{@width}} height={{@height}}
  >
</div>
```

First, we have a container element for styling purposes.

Then we have an `<img>` tag to request and render the static map image from Mapbox.

We generated a reasonable default value for the `alt` attribute` based on the value of `{{@lat}}` and `{{@lng}}`. These are the *[arguments](TODO: link to arguments)* that the invoker of the `<Map>` component would need to specify when invoking it.

By *[parameterizing](TODO: link to parameterizing)* our component using arguments, we made a reusable component that can be invoked from different parts of the app and customized to meet the needs for those specific contexts.

We have already seen this in action when using the `<LinkTo>` component earlier; we had to specify a `@route=...` argument so that it knew what page to navigate to.

You may also notice that we are directly *[interpolating](TODO: link to interpolating)* values into the `alt` attribute's value. Ember will automatically concatenate these interpolated values into a final string value for us, including doing any necessary escaping, if appropriate.

Next, we used `...attributes` to allow the invoker to further
customize the `<img>` tag, such as passing extra attributes such
as `class`, as well as *[overriding](TODO: link to overriding)* our default `alt` attribute with a more specific or human-friendly one.

*The ordering is important here!* Ember applies the attributes in the order that they appear. By assigning the `alt` attribute first, *before* `...attributes` is applied, we are explicitly allowing the invoker to optionally pass a different value for the `alt` attribute.

Since the passed-in `alt` attribute (if any exists) will appear _after_ ours, it will override the value we specified. On the other hand, it is important that we assign `src`, `width`, and `height` after `...attributes`, so that they don't get accidentally overwritten by the invoker.

The `src` attribute interpolates together all the required parameters into the URL format for Mapbox's [static map image API](https://docs.mapbox.com/api/maps/#static-images), including the escaped access token from `this.token`.

Finally, since we are using the `@2x` "retina" image, we should specify the `width` and `height` attributes. Otherwise, the `<img>` will be rendered at twice the size than what we expected!

That's a lot of behavior that we just added into a single component, so let's write some tests! In particular, we should make sure to have some *[test coverage](TODO: link to test coverage)* for the overriding HTML attributes behavior we discussed above.

<!-- TODO: format diff -->
```
import { module, test } from 'qunit';
import { setupRenderingTest } from 'ember-qunit';
import { render, find } from '@ember/test-helpers';
import hbs from 'htmlbars-inline-precompile';
import ENV from 'super-rentals/config/environment';

 module('Integration | Component | map', function(hooks) {
  setupRenderingTest(hooks);

  test('it renders a map image for the specified parameters', async function(assert) {
    await render(hbs`<Map
      @lat="37.7797"
      @lng="-122.4184"
      @zoom="10"
      @width="150"
      @height="120"
    />`);

    assert.dom('.map').exists();
    assert.dom('.map img').hasAttribute('alt', 'Map image at coordinates 37.7797,-122.4184');
    assert.dom('.map img').hasAttribute('src', /^https:\/\ api\.mapbox\.com/);
    assert.dom('.map img').hasAttribute('width', '150');
    assert.dom('.map img').hasAttribute('height', '120');

    let { src } = find('.map img');
    let token = encodeURIComponent(ENV.MAPBOX_ACCESS_TOKEN);

    assert.ok(src.includes('-122.4184,37.7797,10'), 'the src should include the lng,lat,zoom parameter');
    assert.ok(src.includes('150x120@2x'), 'the src should include the width,height and @2x parameter');
    assert.ok(src.includes(`access_token=${token}`), 'the src should include the escaped access token');
  });

  test('the default alt attribute can be overriden', async function(assert) {
    await render(hbs`<Map
      @lat="37.7797"
      @lng="-122.4184"
      @zoom="10"
      @width="150"
      @height="120"
      alt="A map of San Francisco"
    />`);

    assert.dom('.map img').hasAttribute('alt', 'A map of San Francisco');
  });

  test('the src, width and height attributes cannot be overriden', async function(assert) {
      await render(hbs`<Map
        @lat="37.7797"
        @lng="-122.4184"
        @zoom="10"
        @width="150"
        @height="120"
        src="/assets/images/teaching-tomster.png"
        width="200"
        height="300"
      />`);

    assert.dom('.map img').hasAttribute('src', /^https:\/\/api\.mapbox\.com/);
    assert.dom('.map img').hasAttribute('width', '150');
    assert.dom('.map img').hasAttribute('height', '120');
  });
});
```

*Finger crossed...* Let's run our tests.

<!-- TODO: screenshot of tests? -->

Hey, all the tests passed! But does that mean it actually works in practice? Let's find out!

<!-- TODO: screenshot? -->

Hey! That's a map!

<div class="cta">
  <div class="cta-note">
    <div class="cta-note-body">
      <div class="cta-note-heading">Zoey says...</div>
      <div class="cta-note-message">
        If the map image failed to load, make sure you have the correct `MAPBOX_ACCESS_TOKEN` in `config/environment.js`. Don't forget to restart the development and test servers after editing your config file!
      </div>
    </div>
    <img src="/images/mascots/zoey.png" role="presentation" alt="Ember Mascot">
  </div>
</div>

<!-- TODO: track ember-cli/ember-cli#8782 -->

Finally, we can add an assertion to the `<Rental>` tests to make sure we rendered the `<Map>` component successfully.

<!-- TODO: format diff -->
```
import { module, test } from 'qunit';
import { setupRenderingTest } from 'ember-qunit';
import { render } from '@ember/test-helpers';
import hbs from 'htmlbars-inline-precompile';

module('Integration | Component | rental', function(hooks) {
  setupRenderingTest(hooks);

  test('it renders information about a rental property', async function(assert) {
    await render(hbs`<Rental />`);

    assert.dom('article').hasClass('rental');
    assert.dom('article h3').containsText('Grand Old Mansion');
    assert.dom('article .detail.owner').containsText('Veruca Salt');
    assert.dom('article .detail.type').containsText('Standalone');
    assert.dom('article .detail.location').containsText('San Francisco');
    assert.dom('article .detail.bedrooms').containsText('15');
    assert.dom('article .image').exists();
    assert.dom('article .map').exists();
  });
});
```
