{"data":{"type":"contents","id":"tutorial/part-2/provider-components","attributes":{"content":"<!-- Heads up! This is a generated file, do not edit directly. You can find the source at https://github.com/ember-learn/super-rentals-tutorial/blob/master/src/markdown/tutorial/part-2/12-provider-components.md -->\n\nIn this chapter, we'll work on adding a new search feature, and refactor our `index.hbs` template into a new component along the way. We'll learn about a new pattern for passing data around between components, too! Once we're done, our page will look like this:\n\n<!-- TODO: make this a gif instead -->\n\n<img src=\"/images/tutorial/part-2/provider-components/filtered-results@2x.png\" alt=\"The Super Rentals app by the end of the chapter\" width=\"1024\" height=\"797\">\n\nDuring this refactor, you will learn about:\n\n- Using Ember's built-in `<Input>` component\n- The provider component pattern\n- Using block parameters when invoking components\n- Yielding data to caller components\n\n## Add input\n\nAs our app grows and as we add more features to it, one thing that would be really nice to have is some search functionality. It would be great if our users could just type a word into a search box and our app could just respond with matching and relevant rentals. So how could we go about implementing this feature?\n\nWell, we can start simple. Before we worry about implementing the \"search\" part of this feature, let's just get something on the page. The first step is to add an `<input>` tag to our `index` page, and make it look pretty with a class.\n\n```handlebars { data-filename=\"app/templates/index.hbs\" data-diff=\"+8,+9,+10,+11,+12\" }\n<Jumbo>\n  <h2>Welcome to Super Rentals!</h2>\n  <p>We hope you find exactly what you're looking for in a place to stay.</p>\n  <LinkTo @route=\"about\" class=\"button\">About Us</LinkTo>\n</Jumbo>\n\n<div class=\"rentals\">\n  <label>\n    <span>Where would you like to stay?</span>\n    <input class=\"light\">\n  </label>\n\n  <ul class=\"results\">\n    {{#each @model as |rental|}}\n      <li><Rental @rental={{rental}} /></li>\n    {{/each}}\n  </ul>\n</div>\n```\n\nNow if we refresh the UI, it has an `<input>` element on the page.\n\n<img src=\"/images/tutorial/part-2/provider-components/homepage-with-inert-search@2x.png\" alt=\"The homepage with a search box, but it doesn't work yet.\" width=\"1024\" height=\"1327\">\n\nAwesome, one step done. Now, this input looks great, but it doesn't actually _do_ anything.\n\n## Refactoring the index template into a component\n\nIn order to make our search box actually work, we are going to need to retain and store the text that the user types in when they use the search box. This text is the search query, and it is a piece of _[state](../../../components/component-state-and-actions/)_ that is going to change whenever the user types something into the search box.\n\nBut where are we going to put this newly-introduced piece of state? In order to wire up the search box, we need a place to store the search query. At the moment, our search box lives on the `index.hbs` route template, which doesn't have a good place to store this search query state. Darn, this would be so much easier to do if we had a component, because we could just store the state directly on the component!\n\nWait...why don't we just refactor the search box into a component? Once we do that, this will all be a bit easier—hooray!\n\nLet's start simple again and begin our refactor by creating a new template for our component, which we will call `rentals.hbs`.\n\n```handlebars { data-filename=\"app/components/rentals.hbs\" }\n<div class=\"rentals\">\n  <label>\n    <span>Where would you like to stay?</span>\n    <input class=\"light\">\n  </label>\n\n  <ul class=\"results\">\n    {{#each @rentals as |rental|}}\n      <li><Rental @rental={{rental}} /></li>\n    {{/each}}\n  </ul>\n</div>\n```\n\nThere is one minor change to note here: while extracting our markup into a component, we also renamed the `@model` argument to be `@rentals` instead, just in order to be a little more specific about what we're iterating over in our `{{#each}}` loop. Otherwise, all we're doing here is copy-pasting what was on our `index.hbs` page into our new component template. Now we just need to actually use our new component in the index template where we started this whole refactor! Let's render our `<Rentals>` component in our `index.hbs` template.\n\n```handlebars { data-filename=\"app/templates/index.hbs\" data-diff=\"-7,-8,-9,-10,-11,-12,-13,-14,-15,-16,-17,-18,+19\" }\n<Jumbo>\n  <h2>Welcome to Super Rentals!</h2>\n  <p>We hope you find exactly what you're looking for in a place to stay.</p>\n  <LinkTo @route=\"about\" class=\"button\">About Us</LinkTo>\n</Jumbo>\n\n<div class=\"rentals\">\n  <label>\n    <span>Where would you like to stay?</span>\n    <input class=\"light\">\n  </label>\n\n  <ul class=\"results\">\n    {{#each @model as |rental|}}\n      <li><Rental @rental={{rental}} /></li>\n    {{/each}}\n  </ul>\n</div>\n<Rentals @rentals={{@model}} />\n```\n\nRemember the small change we made in the markup when we extracted our `<Rentals>` component? We renamed the `@model` argument to be `@rentals`. Because we made that change in our component, we now need to pass the `@model` argument into the `<Rentals>` component as `@rentals`. Once we do this, everything should be wired up properly so that the `@model` is passed into `<Rentals>` as `@rentals`, just as we expect.\n\nLet's check our UI as well to make sure that we didn't break anything during this refactor...\n\n<img src=\"/images/tutorial/part-2/provider-components/homepage-with-rentals-component@2x.png\" alt=\"The homepage looks exactly the same as before!\" width=\"1024\" height=\"1327\">\n\nAwesome, it looks exactly the same!\n\nNow that we've finished our refactor and tried it out in the UI, let's write a test for it as well.\n\n```js { data-filename=\"tests/integration/components/rentals-test.js\" }\nimport { module, test } from 'qunit';\nimport { setupRenderingTest } from 'super-rentals/tests/helpers';\nimport { render } from '@ember/test-helpers';\nimport { hbs } from 'ember-cli-htmlbars';\n\nmodule('Integration | Component | rentals', function (hooks) {\n  setupRenderingTest(hooks);\n\n  test('it renders all given rental properties by default', async function (assert) {\n    this.setProperties({\n      rentals: [\n        {\n          id: 'grand-old-mansion',\n          title: 'Grand Old Mansion',\n          owner: 'Veruca Salt',\n          city: 'San Francisco',\n          location: {\n            lat: 37.7749,\n            lng: -122.4194,\n          },\n          category: 'Estate',\n          type: 'Standalone',\n          bedrooms: 15,\n          image:\n            'https://upload.wikimedia.org/wikipedia/commons/c/cb/Crane_estate_(5).jpg',\n          description:\n            'This grand old mansion sits on over 100 acres of rolling hills and dense redwood forests.',\n        },\n        {\n          id: 'urban-living',\n          title: 'Urban Living',\n          owner: 'Mike Teavee',\n          city: 'Seattle',\n          location: {\n            lat: 47.6062,\n            lng: -122.3321,\n          },\n          category: 'Condo',\n          type: 'Community',\n          bedrooms: 1,\n          image:\n            'https://upload.wikimedia.org/wikipedia/commons/2/20/Seattle_-_Barnes_and_Bell_Buildings.jpg',\n          description:\n            'A commuters dream. This rental is within walking distance of 2 bus stops and the Metro.',\n        },\n        {\n          id: 'downtown-charm',\n          title: 'Downtown Charm',\n          owner: 'Violet Beauregarde',\n          city: 'Portland',\n          location: {\n            lat: 45.5175,\n            lng: -122.6801,\n          },\n          category: 'Apartment',\n          type: 'Community',\n          bedrooms: 3,\n          image:\n            'https://upload.wikimedia.org/wikipedia/commons/f/f7/Wheeldon_Apartment_Building_-_Portland_Oregon.jpg',\n          description:\n            'Convenience is at your doorstep with this charming downtown rental. Great restaurants and active night life are within a few feet.',\n        },\n      ],\n    });\n\n    await render(hbs`<Rentals @rentals={{this.rentals}} />`);\n\n    assert.dom('.rentals').exists();\n    assert.dom('.rentals input').exists();\n\n    assert.dom('.rentals .results').exists();\n    assert.dom('.rentals .results li').exists({ count: 3 });\n\n    assert\n      .dom('.rentals .results li:nth-of-type(1)')\n      .containsText('Grand Old Mansion');\n\n    assert\n      .dom('.rentals .results li:nth-of-type(2)')\n      .containsText('Urban Living');\n\n    assert\n      .dom('.rentals .results li:nth-of-type(3)')\n      .containsText('Downtown Charm');\n  });\n});\n```\n\nNow, if we try running our tests, they should all pass after making this change.\n\n<img src=\"/images/tutorial/part-2/provider-components/pass-1@2x.png\" alt=\"The new test is passing.\" width=\"1024\" height=\"1024\">\n\n## Using Ember's `<Input>`\n\nNow that we have our component all set up, we can finally wire up our search box and store our search query! First things first: let's create a component class to store our query state.\n\n```js { data-filename=\"app/components/rentals.js\" }\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\n\nexport default class RentalsComponent extends Component {\n  @tracked query = '';\n}\n```\n\nNext, we'll wire up our query state in the component template.\n\n```handlebars { data-filename=\"app/components/rentals.hbs\" data-diff=\"-4,+5\" }\n<div class=\"rentals\">\n  <label>\n    <span>Where would you like to stay?</span>\n    <input class=\"light\">\n    <Input @value={{this.query}} class=\"light\" />\n  </label>\n\n  <ul class=\"results\">\n    {{#each @rentals as |rental|}}\n      <li><Rental @rental={{rental}} /></li>\n    {{/each}}\n  </ul>\n</div>\n```\n\nInteresting! There are a few things happening in this one-line template change. First, we're moving from using a plain HTML `<input>` tag to using an `<Input>` tag instead! As it turns out, Ember provides us with a helpful little _[`<Input>` component](../../../components/built-in-components/#toc_input)_ for this exact use case. The `<Input>` component is actually just a wrapper around the `<input>` element.\n\nEmber's `<Input>` component is pretty neat; it will wire up things behind the scenes such that, whenever the user types something into the input box, `this.query` changes accordingly. In other words, `this.query` is kept in sync with the value of what is being searched; we finally have the perfect way of storing the state of our search query!\n\n<div class=\"cta\">\n  <div class=\"cta-note\">\n    <div class=\"cta-note-body\">\n      <div class=\"cta-note-heading\">Zoey says...</div>\n      <div class=\"cta-note-message\">\n        <p>If you want to see this in action, try adding <code>&#x3C;p>{{this.query}}&#x3C;/p></code> to the component template and watch it update live as you type!</p>\n      </div>\n    </div>\n    <img src=\"/images/mascots/zoey.png\" role=\"presentation\" alt=\"\">\n  </div>\n</div>\n\n## Adding the `<Rentals::Filter>` Provider Component\n\nNow that our search query is wired up to our `<Rentals>` component, we can get into the really fun stuff! Namely, we can make our component _filter_ results based on our search query. In order to encapsulate this functionality, we'll create another component called `<Rentals::Filter>`.\n\n```js { data-filename=\"app/components/rentals/filter.js\" }\nimport Component from '@glimmer/component';\n\nexport default class RentalsFilterComponent extends Component {\n  get results() {\n    let { rentals, query } = this.args;\n\n    if (query) {\n      rentals = rentals.filter((rental) => rental.title.includes(query));\n    }\n\n    return rentals;\n  }\n}\n```\n\n```handlebars { data-filename=\"app/components/rentals/filter.hbs\" }\n{{yield this.results}}\n```\n\nIn the `<Rentals::Filter>` component class, we have created a getter to do the work of filtering through our rentals based on two arguments: `@rentals` and `@query`. Inside of our getter function, we have these arguments accessible to us from `this.args`.\n\nIn our component template, we are not actually _rendering_ anything. Instead, we're yielding to something, using the `{{yield}}` keyword, a syntax that [we have seen before](../../part-1/component-basics/). As we might recall, the purpose of `{{yield}}` is to render the _block_ that is passed in by the component's _caller_, which is the thing that is invoking the current component (a template or another component, for example). But in this specific case, we don't just have a `{{yield}}` keyword. Instead, we have `this.results` _inside_ of our `{{yield}}` keyword. What is that doing, exactly?\n\nWell, in order to answer this question, let's look at how the data that we're yielding is being used in the `<Rentals>` component.\n\n```handlebars { data-filename=\"app/components/rentals.hbs\" data-diff=\"-8,-9,-10,+11,+12,+13,+14,+15\" }\n<div class=\"rentals\">\n  <label>\n    <span>Where would you like to stay?</span>\n    <Input @value={{this.query}} class=\"light\" />\n  </label>\n\n  <ul class=\"results\">\n    {{#each @rentals as |rental|}}\n      <li><Rental @rental={{rental}} /></li>\n    {{/each}}\n    <Rentals::Filter @rentals={{@rentals}} @query={{this.query}} as |results|>\n      {{#each results as |rental|}}\n        <li><Rental @rental={{rental}} /></li>\n      {{/each}}\n    </Rentals::Filter>\n  </ul>\n</div>\n```\n\nHere, we're invoking `<Rentals::Filter>` similar to how we've invoked other components. We're passing in `@rentals` and `@query` as arguments, and we're also passing in a block. The block is the content that is enclosed in between the component's opening and closing tags (`<Rentals::Filter>...</Rentals::Filter>`). We have seen both of these before.\n\nHowever, the main difference here is the use of `as |results|` when we are invoking our `<Rentals::Filter>` component. Incidentally, this new syntax goes hand-in-hand with the `{{yield this.results}}` syntax we were introduced to in the component template.\n\nThe `as |results|` syntax might look a little new to us, but it isn't the first time that we've seen this feature in action. Back when we first learned about the `{{#each}}` syntax, which we use to loop over a collection, we wrote something like this: `{{#each @items as |item|}}...some content here...{{/each}}`.\n\nWhen we use this syntax, we are passing a block—the `...some content here...` in our example—to `{{#each}}`. Ember will iterate through the array we provided (`@items`) and render our block _once per item_ in the array.\n\nInside of our block, we need to be able to access the current item _somehow_. The `{{#each}}` syntax provides the item to our block via the `as |item|` declaration, which creates a local variable `item`, also known as a _[block parameter](../../../components/looping-through-lists/)_. In other words, as we iterate through `@items`, we will have access to the current item that we're looping over through the block parameter (`item`) The block parameter is only accessible from within inside of the block. Ember will fill in the block parameter with the current item of the iteration, and it will do this each time that it renders our block.\n\nThe need to provide some data to a block is not unique to the `{{#each}}` syntax. In this case, our `<Rentals::Filter>` component wants to take the unfiltered list of rental properties and match them against the user's query. Once the component has matched the rentals against the query, it will need to provide a filtered list of rental properties to its caller (the `<Rentals>` component).\n\nAs it turns out, this ability to provide block params is not a superpower that only built-in syntaxes like `{{#each}}` can use. We can do this with our own components as well. In fact, Ember allows us to pass arbitrary data to blocks in the form of passing in additional arguments to the `{{yield}}` keyword. Indeed, this is exactly what we did with `{{yield this.results}}` in the `<Rentals::Filter>` component.\n\nIn our `<Rentals>` component, we used the `as |results|` syntax when invoking `<Rentals::Filter>`. Just like with the `{{#each}}` syntax, this block parameter syntax allowed our block to access the yielded data using the local variable `results`. The yielded data came from `{{yield this.results}}`, where `this.results` is our filtered list of rental properties.\n\n<div class=\"cta\">\n  <div class=\"cta-note\">\n    <div class=\"cta-note-body\">\n      <div class=\"cta-note-heading\">Zoey says...</div>\n      <div class=\"cta-note-message\">\n        <p>The local variable name <code>results</code> is arbitrary, and isn't special in any way! You could name it anything: <code>as |data|</code>, <code>as |filtered|</code>, or even <code>as |banana|</code>! In fact, the <code>... as |banana|</code> syntax is the same as declaring a local variable in JavaScript.\nJust as we can create a variable like <code>let banana = ...</code>, and then have access to that variable whenever we call <code>banana</code>, we can also have access to the yielded item by using whatever variable name we gave to our block parameter. The important thing here is that however you name the block param is how you will have access to the yielded data from inside the block.</p>\n      </div>\n    </div>\n    <img src=\"/images/mascots/zoey.png\" role=\"presentation\" alt=\"\">\n  </div>\n</div>\n\nInterestingly, if we take a look at our `<Rentals::Filter>` component template, we see that we don't actually render any content. Instead, this component's only responsibility is to set up some piece of state (`this.results`, the list of filtered rental properties), and then yield that state back up to its caller (`<Rentals>`) in the form of a block parameter (`as |results|`).\n\nThis is called the _provider component pattern_, which we see in action with one component providing data up to its caller.\n\nOkay, now that we have a better sense of which component is rendering what and the theory behind why all of this is happening, let's answer the big unanswered question: does this even work? If we try out our search box in the UI, what happens?\n\n<img src=\"/images/tutorial/part-2/provider-components/filtered-results@2x.png\" alt=\"Trying out the search box.\" width=\"1024\" height=\"797\">\n\nHooray, it works! Awesome. Now that we've tried this out manually in the UI, let's write a test for this new behavior as well.\n\n```js { data-filename=\"tests/integration/components/rentals-test.js\" data-diff=\"-3,+4,-10,+11,+67,+69,+90,+91,+92,+93,+94,+95,+96,+97,+98,+99,+100,+101,+102,+103,+104,+105,+106,+107,+108\" }\nimport { module, test } from 'qunit';\nimport { setupRenderingTest } from 'super-rentals/tests/helpers';\nimport { render } from '@ember/test-helpers';\nimport { render, fillIn } from '@ember/test-helpers';\nimport { hbs } from 'ember-cli-htmlbars';\n\nmodule('Integration | Component | rentals', function (hooks) {\n  setupRenderingTest(hooks);\n\n  test('it renders all given rental properties by default', async function (assert) {\n  hooks.beforeEach(function () {\n    this.setProperties({\n      rentals: [\n        {\n          id: 'grand-old-mansion',\n          title: 'Grand Old Mansion',\n          owner: 'Veruca Salt',\n          city: 'San Francisco',\n          location: {\n            lat: 37.7749,\n            lng: -122.4194,\n          },\n          category: 'Estate',\n          type: 'Standalone',\n          bedrooms: 15,\n          image:\n            'https://upload.wikimedia.org/wikipedia/commons/c/cb/Crane_estate_(5).jpg',\n          description:\n            'This grand old mansion sits on over 100 acres of rolling hills and dense redwood forests.',\n        },\n        {\n          id: 'urban-living',\n          title: 'Urban Living',\n          owner: 'Mike Teavee',\n          city: 'Seattle',\n          location: {\n            lat: 47.6062,\n            lng: -122.3321,\n          },\n          category: 'Condo',\n          type: 'Community',\n          bedrooms: 1,\n          image:\n            'https://upload.wikimedia.org/wikipedia/commons/2/20/Seattle_-_Barnes_and_Bell_Buildings.jpg',\n          description:\n            'A commuters dream. This rental is within walking distance of 2 bus stops and the Metro.',\n        },\n        {\n          id: 'downtown-charm',\n          title: 'Downtown Charm',\n          owner: 'Violet Beauregarde',\n          city: 'Portland',\n          location: {\n            lat: 45.5175,\n            lng: -122.6801,\n          },\n          category: 'Apartment',\n          type: 'Community',\n          bedrooms: 3,\n          image:\n            'https://upload.wikimedia.org/wikipedia/commons/f/f7/Wheeldon_Apartment_Building_-_Portland_Oregon.jpg',\n          description:\n            'Convenience is at your doorstep with this charming downtown rental. Great restaurants and active night life are within a few feet.',\n        },\n      ],\n    });\n  });\n\n  test('it renders all given rental properties by default', async function (assert) {\n    await render(hbs`<Rentals @rentals={{this.rentals}} />`);\n\n    assert.dom('.rentals').exists();\n    assert.dom('.rentals input').exists();\n\n    assert.dom('.rentals .results').exists();\n    assert.dom('.rentals .results li').exists({ count: 3 });\n\n    assert\n      .dom('.rentals .results li:nth-of-type(1)')\n      .containsText('Grand Old Mansion');\n\n    assert\n      .dom('.rentals .results li:nth-of-type(2)')\n      .containsText('Urban Living');\n\n    assert\n      .dom('.rentals .results li:nth-of-type(3)')\n      .containsText('Downtown Charm');\n  });\n\n  test('it updates the results according to the search query', async function (assert) {\n    await render(hbs`<Rentals @rentals={{this.rentals}} />`);\n\n    assert.dom('.rentals').exists();\n    assert.dom('.rentals input').exists();\n\n    await fillIn('.rentals input', 'Downtown');\n\n    assert.dom('.rentals .results').exists();\n    assert.dom('.rentals .results li').exists({ count: 1 });\n    assert.dom('.rentals .results li').containsText('Downtown Charm');\n\n    await fillIn('.rentals input', 'Mansion');\n\n    assert.dom('.rentals .results').exists();\n    assert.dom('.rentals .results li').exists({ count: 1 });\n    assert.dom('.rentals .results li').containsText('Grand Old Mansion');\n  });\n});\n```\n\nGreat! In the process of adding this test, we'll notice that we also extracted our setup (`setProperties`) into the before hooks. We also used the `fillIn` test helper in our newly-added test.\n\n<div class=\"cta\">\n  <div class=\"cta-note\">\n    <div class=\"cta-note-body\">\n      <div class=\"cta-note-heading\">Zoey says...</div>\n      <div class=\"cta-note-message\">\n        <p>This search functionality is not perfect. Ideally, it would also be case-insensitive, and also allow you to search by city, category, type, or description. If you're looking for a challenge, see if you can improve on our search!</p>\n      </div>\n    </div>\n    <img src=\"/images/mascots/zoey.png\" role=\"presentation\" alt=\"\">\n  </div>\n</div>\n\n<img src=\"/images/tutorial/part-2/provider-components/pass-2@2x.png\" alt=\"The new test is passing.\" width=\"1024\" height=\"1024\">","description":"In this chapter, we'll work on adding a new search feature, and refactor our index.hbs template into a new component along the way. We'll learn about a new pattern for passing data around between components, too! Once we're done, our page will look like..."}}}